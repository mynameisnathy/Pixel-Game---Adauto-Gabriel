<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Fase 4 - Espaço</title>
</head>
<body>
    <div class="game-board">
        <button class="start-button" onclick="window.location.href='fases.html'">Voltar</button>
        <img src="adauto.png" class="mario">
        <img src="/asteroide.png" class="pipe">
        <img src="/casa2.png" class="finish" style="display:none">
        <div class="game-over">
            <button class="restart">Tente de novo</button>
        </div>
    </div>
    <style>

        @font-face {
            font-family: 'minecraft';
            src: url(minecraft/Minecraft.ttf) format('truetype');
        }

        *{
    margin: 0;
    padding: 0;
    box-sizing: 0;
    font-family: 'Minecraft';

}

    body {
        background-image: url('https://media.istockphoto.com/id/2209508238/vector/pixel-art-planet-surface-background-cosmic-moon-game-location-outer-space-seamless-vector.jpg?s=612x612&w=0&k=20&c=scGhX66dyHHLdhiEy59hTGCVA5A_MxfjCz1ZBlGE070=');
        overflow: hidden;
        background-color: #49016d;
        background-attachment: fixed;
        background-position: center bottom;
        background-size: 85% 100%;
    }

    .start-button {
      margin-top: 20px;
      margin-left: 20px;
      padding: 10px 25px;
      font-size: 20px;
      background-color: #d8a6ff;
      font-family: 'Minecraft';
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 3px 3px #9c58c4;
    }

    .start-button:hover {
      background-color: #45176e;
      box-shadow: 3px 3px #37094f;
      color: white;
    } 


.game-board{
    width: 100%;
    height: 510px;
    margin: 0 auto;
    position: relative;
    overflow: hidden;

}

.pipe{ 
    position: absolute;
    bottom: 10px; 
    width: 80px;
    animation: pipe-animations 2s infinite linear;
}

.mario{
    width: 75px;
    position: absolute;
    bottom: 0px;
    left: 0px;
}

.finish{
    bottom: 0px;
    position: absolute;
    width: 300px;
    right: -200px;
    display: none; 
}

.jump{
    animation: mario-animation 750ms ease-out;
}


.game-over{
    visibility: hidden;
    display: flex;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    justify-content: center;
    align-items: center;
    background-color:rgba(92, 41, 115, 0.578);
}

.restart{
    height: 60px;
    background-color: rgba(85, 41, 115, 0.578);
    width: 180px;
    border-radius: 10px;
    border: none;
    font-size: 20px;
    font-family: 'minecraft';
    color: rgba(240, 215, 255, 0.922);
    cursor: pointer;
}

@keyframes pipe-animations {
    from{
        right: -80px;
    }

    to{
        right: 100%;
    }
}

@keyframes finish-anim {
    from { right: -200px; }
    to { right: 100%; }
}

@keyframes mario-animation{
    0%{
        bottom: 0;
    }

    40%{
        bottom: 120px
    }

    50%{
        bottom: 120px;
    }

    60%{
        bottom: 120px
    }

    70% {
        bottom: 60px
    }  

    80%{
        bottom: 0px
    }

    100%{
        bottom: 0px
    }
}


@media (max-width: 80px){
    .mario{
        width: 80px;
        position: absolute;
        bottom: 0px;
    }

    .pipe{
        position: absolute;
        bottom: 0;
        width: 55px;
        animation: pipe-animations 2s infinite linear;
    }

    .finish {
        position: absolute;
        bottom: 0;
        width: 300px;
        right: -200px;
        display: none;
    }
    }

    </style>

<script>
     const mario = document.querySelector('.mario');
    const pipe = document.querySelector('.pipe');
    const finish = document.querySelector('.finish');
 
    const gameOver = document.querySelector('.game-over');
    const restartButton = document.querySelector('.restart');
 
    // ao iniciar, aplica o personagem selecionado 
    const savedCharacter = localStorage.getItem('selectedCharacter');
    if (savedCharacter) {
        // garante caminho relativo (preserve nome)
        mario.src = savedCharacter;
    }
 
    let pipesPassed = 0;
    const pipesToFinish = 5;
    const nextPhaseUrl = 'fases.html';
 
    const jump = () => {
        if (mario.classList.contains('jump')) return;
        mario.classList.add('jump');
        setTimeout(() => mario.classList.remove('jump'), 500);
    }
 
    pipe.addEventListener('animationiteration', () => {
        pipesPassed++;
        if (pipesPassed >= pipesToFinish) {
            pipe.style.display = 'none';
            finish.style.display = 'block';
            finish.style.animation = 'finish-anim 3000ms linear forwards';
        }
    });
 
    const loop = setInterval(() => {
        if (finish && finish.style.display === 'block') {
            const finishPosition = finish.offsetLeft;
            if (finishPosition <= 50) {
                finish.style.animation = 'none';
                finish.style.left = `${finishPosition}px`;
                clearInterval(loop);
                // mostra overlay de vitória ou redireciona; aqui redireciona após pequena pausa
                setTimeout(() => window.location.href = nextPhaseUrl, 700);
                return;
            }
        }
 
        if (pipe && pipe.style.display !== 'none') {
            const pipePosition = pipe.offsetLeft;
            const marioPosition = +window.getComputedStyle(mario).bottom.replace('px', '');
            if (pipePosition <= 50 && pipePosition > 0 && marioPosition < 65) {
                pipe.style.animation = 'none';
                pipe.style.left = `${pipePosition}px`;
                mario.style.animation = 'none';
                mario.style.bottom = `${marioPosition}px`;
                gameOver.style.visibility = 'visible';
                clearInterval(loop);
            }
        }
    }, 10);
 
    const restart = () => {
        gameOver.style.visibility = 'hidden';
        pipesPassed = 0;
        pipe.style.display = 'block';
        pipe.style.animation = 'pipe-animations 2s infinite linear';
        pipe.style.left = '';
        finish.style.display = 'none';
        finish.style.animation = 'none';
        finish.style.left = '';
        // restaura imagem do mario com a seleção salva (não limpa localStorage)
        const saved = localStorage.getItem('selectedCharacter');
        mario.src = saved;
        mario.style.width = '70px';
        mario.style.bottom = '0px';
        mario.style.marginLeft = '';
        mario.style.animation = '';
        // recarregar a página é opcional; aqui não recarrego para manter seleção
        // reiniciar loop simples: recarrega (ou você pode re-criar o setInterval). Para simplicidade:
        setTimeout(() => window.location.reload(), 200);
    }
 
    document.addEventListener('keydown', jump);
    document.addEventListener('touchstart', jump);
    restartButton.addEventListener('click', restart);

</script>
</body>
</html>